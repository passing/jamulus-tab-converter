<!DOCTYPE html>
<html>
    <head>
        <style>
            table {
                width: 100%;
            }
            input {
                width: 100%;
            }
            textarea {
                width: 100%;
                height: 600px;
            }
            td {
                vertical-align: top;
            }
        </style>
        <script>
            function pre_attach(id, text, style, break_tag) {
                const max_length = 1600;
                const html_pre = {
                    default: '<pre>',
                    small: '<pre><small>',
                    big: '<pre><big>',
                    big_bold: '<pre><big><b>'
                };
                const html_break = {
                    br: '<br>',
                    p: '<p>'
                }
                const html_post = {
                    default: '</pre>',
                    small: '</small></pre>',
                    big: '</big></pre>',
                    big_bold: '</b></big></pre>'
                };

                // get current length of output
                var length = document.getElementById(id).value.length;

                if (length == 0) {
                    // output is empty, add pre tags and text
                    document.getElementById(id).value += html_pre[style] + text;
                    return true;
                } else if ((text != null) && (length + html_break[break_tag].length + text.length + html_post[style].length <= max_length)) {
                    // output has enough space left for text and html tags
                    document.getElementById(id).value += html_break[break_tag] + text;
                    return true;
                } else {
                    // output would overflow, add post tags and return false to indicate that text was not added
                    document.getElementById(id).value += html_post[style];
                    return false;
                }
            }

            function pre_convert() {
                const outputs = ['text_output_1', 'text_output_2', 'text_output_3', 'text_output_4', 'text_output_5'];

                for (const output of outputs) {
                    // reset all output fields
                    document.getElementById(output).value = '';
                }

                var input = document.getElementById("text_input").value.split('\n');
                var style = document.getElementById("text_output_style").value;
                var output = 0;
                var break_tag = 'br';

                for (const line of input) {
                    if (line.trimEnd() == '') {
                        break_tag = 'p';
                    } else {
                        while (!pre_attach(outputs[output], line.trimEnd(), style, break_tag)) {
                            output += 1;
                        }
                        break_tag = 'br';
                    }
                }
                pre_attach(outputs[output], null, style, 'br');
            }

            function clean_double_newlines(text) {
                var input = text.split('\n');
                var output = [];

                // loop over all lines
                for (var i = 0; i < input.length; i++) {
                    if (i % 2 == 0) {
                        // add odd lines to output
                        output.push(input[i])
                    } else if (input[i] != '') {
                        // return original text if any even line is not empty
                        return text;
                    }
                }

                // return all odd lines when all even lines were empty
                return output.join('\n');
            }

            function clean_leading_spaces(text) {
                var input = text.split('\n');
                var output = [];
                var trim = null;

                for (const line of input) {
                    // only check lines that have non space characters
                    if (/\S/.test(line)) {
                        // get number of leading spaces
                        var trailing_spaces = /^\s*/.exec(line)[0].length
                        if (trim == null || trailing_spaces < trim) {
                            trim = trailing_spaces;
                        }
                    }
                }

                for (const line of input) {
                    // trim all lines
                    output.push(line.substring(trim));
                }

                return output.join('\n');
            }

            function clean() {
                var text = document.getElementById("text_input").value;

                text = clean_double_newlines(text);
                text = clean_leading_spaces(text);

                document.getElementById("text_input").value = text;
            }
        </script>
    </head>
    <body>
        <table>
            <tr>
                <td width="50%">
                    <textarea id="text_input"></textarea>
                </td>
                <td>
                    <button onclick="clean()">Clean</button>
                    <select id="text_output_style">
                        <option value="default">Default</option>
                        <option value="small">Small</option>
                        <option value="big">Big</option>
                        <option value="big_bold">Big Bold</option>
                    </select>
                    <button onclick="pre_convert()">Convert</button><br/>
                    <input type="text" id="text_output_1"/>
                    <input type="text" id="text_output_2"/>
                    <input type="text" id="text_output_3"/>
                    <input type="text" id="text_output_4"/>
                    <input type="text" id="text_output_5"/>
                </td>
            </tr>
        </table>
    </body>
</html>
